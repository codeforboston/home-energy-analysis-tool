{
  "version": 3,
  "sources": ["empty-module:#app/utils/cache.server.ts", "../../../../app/routes/admin+/cache.tsx"],
  "sourcesContent": ["module.exports = {};", "// REMIX HMR BEGIN\nif (!window.$RefreshReg$ || !window.$RefreshSig$ || !window.$RefreshRuntime$) {\n  console.warn('remix:hmr: React Fast Refresh only works when the Remix compiler is running in development mode.');\n} else {\n  var prevRefreshReg = window.$RefreshReg$;\n  var prevRefreshSig = window.$RefreshSig$;\n  window.$RefreshReg$ = (type, id) => {\n    window.$RefreshRuntime$.register(type, \"\\\"app/routes/admin+/cache.tsx\\\"\" + id);\n  }\n  window.$RefreshSig$ = window.$RefreshRuntime$.createSignatureFunctionForTransform;\n}\nvar _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\n  import.meta.hot = __hmr__.createHotContext(\n  //@ts-expect-error\n  \"app/routes/admin+/cache.tsx\");\n  import.meta.hot.lastModified = \"1706218436656.8838\";\n}\n// REMIX HMR END\n\nimport { json, redirect } from '@remix-run/node';\nimport { Form, Link, useFetcher, useLoaderData, useSearchParams, useSubmit } from '@remix-run/react';\nimport { Field } from '#app/components/forms.tsx';\nimport { Spacer } from '#app/components/spacer.tsx';\nimport { Button } from '#app/components/ui/button.tsx';\nimport { cache, getAllCacheKeys, lruCache, searchCacheKeys } from '#app/utils/cache.server.ts';\nimport { ensureInstance, getAllInstances, getInstanceInfo } from '#app/utils/litefs.server.ts';\nimport { invariantResponse, useDebounce, useDoubleCheck } from '#app/utils/misc.tsx';\nimport { requireUserWithRole } from '#app/utils/permissions.ts';\nexport const handle = {\n  getSitemapEntries: () => null\n};\nexport async function loader({\n  request\n}) {\n  await requireUserWithRole(request, 'admin');\n  const searchParams = new URL(request.url).searchParams;\n  const query = searchParams.get('query');\n  if (query === '') {\n    searchParams.delete('query');\n    return redirect(`/admin/cache?${searchParams.toString()}`);\n  }\n  const limit = Number(searchParams.get('limit') ?? 100);\n  const currentInstanceInfo = await getInstanceInfo();\n  const instance = searchParams.get('instance') ?? currentInstanceInfo.currentInstance;\n  const instances = await getAllInstances();\n  await ensureInstance(instance);\n  let cacheKeys;\n  if (typeof query === 'string') {\n    cacheKeys = await searchCacheKeys(query, limit);\n  } else {\n    cacheKeys = await getAllCacheKeys(limit);\n  }\n  return json({\n    cacheKeys,\n    instance,\n    instances,\n    currentInstanceInfo\n  });\n}\nexport async function action({\n  request\n}) {\n  await requireUserWithRole(request, 'admin');\n  const formData = await request.formData();\n  const key = formData.get('cacheKey');\n  const {\n    currentInstance\n  } = await getInstanceInfo();\n  const instance = formData.get('instance') ?? currentInstance;\n  const type = formData.get('type');\n  invariantResponse(typeof key === 'string', 'cacheKey must be a string');\n  invariantResponse(typeof type === 'string', 'type must be a string');\n  invariantResponse(typeof instance === 'string', 'instance must be a string');\n  await ensureInstance(instance);\n  switch (type) {\n    case 'sqlite':\n      {\n        await cache.delete(key);\n        break;\n      }\n    case 'lru':\n      {\n        lruCache.delete(key);\n        break;\n      }\n    default:\n      {\n        throw new Error(`Unknown cache type: ${type}`);\n      }\n  }\n  return json({\n    success: true\n  });\n}\nexport default function CacheAdminRoute() {\n  _s();\n  const data = useLoaderData();\n  const [searchParams] = useSearchParams();\n  const submit = useSubmit();\n  const query = searchParams.get('query') ?? '';\n  const limit = searchParams.get('limit') ?? '100';\n  const instance = searchParams.get('instance') ?? data.instance;\n  const handleFormChange = useDebounce(form => {\n    submit(form);\n  }, 400);\n  return <div className=\"container\">\n\t\t\t<h1 className=\"text-h1\">Cache Admin</h1>\n\t\t\t<Spacer size=\"2xs\" />\n\t\t\t<Form method=\"get\" className=\"flex flex-col gap-4\" onChange={e => handleFormChange(e.currentTarget)}>\n\t\t\t\t<div className=\"flex-1\">\n\t\t\t\t\t<div className=\"flex flex-1 gap-4\">\n\t\t\t\t\t\t<button type=\"submit\" className=\"flex h-16 items-center justify-center\">\n\t\t\t\t\t\t\t\uD83D\uDD0E\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<Field className=\"flex-1\" labelProps={{\n            children: 'Search'\n          }} inputProps={{\n            type: 'search',\n            name: 'query',\n            defaultValue: query\n          }} />\n\t\t\t\t\t\t<div className=\"flex h-16 w-14 items-center text-lg font-medium text-muted-foreground\">\n\t\t\t\t\t\t\t<span title=\"Total results shown\">\n\t\t\t\t\t\t\t\t{data.cacheKeys.sqlite.length + data.cacheKeys.lru.length}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex flex-wrap items-center gap-4\">\n\t\t\t\t\t<Field labelProps={{\n          children: 'Limit'\n        }} inputProps={{\n          name: 'limit',\n          defaultValue: limit,\n          type: 'number',\n          step: '1',\n          min: '1',\n          max: '10000',\n          placeholder: 'results limit'\n        }} />\n\t\t\t\t\t<select name=\"instance\" defaultValue={instance}>\n\t\t\t\t\t\t{Object.entries(data.instances).map(([inst, region]) => <option key={inst} value={inst}>\n\t\t\t\t\t\t\t\t{[inst, `(${region})`, inst === data.currentInstanceInfo.currentInstance ? '(current)' : '', inst === data.currentInstanceInfo.primaryInstance ? ' (primary)' : ''].filter(Boolean).join(' ')}\n\t\t\t\t\t\t\t</option>)}\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t</Form>\n\t\t\t<Spacer size=\"2xs\" />\n\t\t\t<div className=\"flex flex-col gap-4\">\n\t\t\t\t<h2 className=\"text-h2\">LRU Cache:</h2>\n\t\t\t\t{data.cacheKeys.lru.map(key => <CacheKeyRow key={key} cacheKey={key} instance={instance} type=\"lru\" />)}\n\t\t\t</div>\n\t\t\t<Spacer size=\"3xs\" />\n\t\t\t<div className=\"flex flex-col gap-4\">\n\t\t\t\t<h2 className=\"text-h2\">SQLite Cache:</h2>\n\t\t\t\t{data.cacheKeys.sqlite.map(key => <CacheKeyRow key={key} cacheKey={key} instance={instance} type=\"sqlite\" />)}\n\t\t\t</div>\n\t\t</div>;\n}\n_s(CacheAdminRoute, \"z/M+YsFfBOrSgQCYrdUVeFTlOpA=\", false, function () {\n  return [useLoaderData, useSearchParams, useSubmit, useDebounce];\n});\n_c = CacheAdminRoute;\nfunction CacheKeyRow({\n  cacheKey,\n  instance,\n  type\n}) {\n  _s2();\n  const fetcher = useFetcher();\n  const dc = useDoubleCheck();\n  const encodedKey = encodeURIComponent(cacheKey);\n  const valuePage = `/admin/cache/${type}/${encodedKey}?instance=${instance}`;\n  return <div className=\"flex items-center gap-2 font-mono\">\n\t\t\t<fetcher.Form method=\"POST\">\n\t\t\t\t<input type=\"hidden\" name=\"cacheKey\" value={cacheKey} />\n\t\t\t\t<input type=\"hidden\" name=\"instance\" value={instance} />\n\t\t\t\t<input type=\"hidden\" name=\"type\" value={type} />\n\t\t\t\t<Button size=\"sm\" variant=\"secondary\" {...dc.getButtonProps({\n        type: 'submit'\n      })}>\n\t\t\t\t\t{fetcher.state === 'idle' ? dc.doubleCheck ? 'You sure?' : 'Delete' : 'Deleting...'}\n\t\t\t\t</Button>\n\t\t\t</fetcher.Form>\n\t\t\t<Link reloadDocument to={valuePage}>\n\t\t\t\t{cacheKey}\n\t\t\t</Link>\n\t\t</div>;\n}\n_s2(CacheKeyRow, \"tH208MjkdZi2owGp90tZwDJICNw=\", false, function () {\n  return [useFetcher, useDoubleCheck];\n});\n_c2 = CacheKeyRow;\nexport function ErrorBoundary({\n  error\n}) {\n  console.error(error);\n  return <div>An unexpected error occurred: {error.message}</div>;\n}\n_c3 = ErrorBoundary;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"CacheAdminRoute\");\n$RefreshReg$(_c2, \"CacheKeyRow\");\n$RefreshReg$(_c3, \"ErrorBoundary\");\n\nwindow.$RefreshReg$ = prevRefreshReg;\nwindow.$RefreshSig$ = prevRefreshSig;"],
  "mappings": "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",
  "names": []
}
