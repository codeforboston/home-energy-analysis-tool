{
  "version": 3,
  "sources": ["../../../../../app/routes/users+/$username_+/notes.$noteId.tsx"],
  "sourcesContent": ["// REMIX HMR BEGIN\nif (!window.$RefreshReg$ || !window.$RefreshSig$ || !window.$RefreshRuntime$) {\n  console.warn('remix:hmr: React Fast Refresh only works when the Remix compiler is running in development mode.');\n} else {\n  var prevRefreshReg = window.$RefreshReg$;\n  var prevRefreshSig = window.$RefreshSig$;\n  window.$RefreshReg$ = (type, id) => {\n    window.$RefreshRuntime$.register(type, \"\\\"app/routes/users+/$username_+/notes.$noteId.tsx\\\"\" + id);\n  }\n  window.$RefreshSig$ = window.$RefreshRuntime$.createSignatureFunctionForTransform;\n}\nvar _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\n  import.meta.hot = __hmr__.createHotContext(\n  //@ts-expect-error\n  \"app/routes/users+/$username_+/notes.$noteId.tsx\");\n  import.meta.hot.lastModified = \"1706218436656.8838\";\n}\n// REMIX HMR END\n\nimport { useForm } from '@conform-to/react';\nimport { parse } from '@conform-to/zod';\nimport { json } from '@remix-run/node';\nimport { Form, Link, useActionData, useLoaderData } from '@remix-run/react';\nimport { formatDistanceToNow } from 'date-fns';\nimport { AuthenticityTokenInput } from 'remix-utils/csrf/react';\nimport { z } from 'zod';\nimport { GeneralErrorBoundary } from '#app/components/error-boundary.tsx';\nimport { floatingToolbarClassName } from '#app/components/floating-toolbar.tsx';\nimport { ErrorList } from '#app/components/forms.tsx';\nimport { Button } from '#app/components/ui/button.tsx';\nimport { Icon } from '#app/components/ui/icon.tsx';\nimport { StatusButton } from '#app/components/ui/status-button.tsx';\nimport { requireUserId } from '#app/utils/auth.server.ts';\nimport { validateCSRF } from '#app/utils/csrf.server.ts';\nimport { prisma } from '#app/utils/db.server.ts';\nimport { getNoteImgSrc, invariantResponse, useIsPending } from '#app/utils/misc.tsx';\nimport { requireUserWithPermission, userHasPermission } from '#app/utils/permissions.ts';\nimport { redirectWithToast } from '#app/utils/toast.server.ts';\nimport { useOptionalUser } from '#app/utils/user.ts';\nexport async function loader({\n  params\n}) {\n  const note = await prisma.note.findUnique({\n    where: {\n      id: params.noteId\n    },\n    select: {\n      id: true,\n      title: true,\n      content: true,\n      ownerId: true,\n      updatedAt: true,\n      images: {\n        select: {\n          id: true,\n          altText: true\n        }\n      }\n    }\n  });\n  invariantResponse(note, 'Not found', {\n    status: 404\n  });\n  const date = new Date(note.updatedAt);\n  const timeAgo = formatDistanceToNow(date);\n  return json({\n    note,\n    timeAgo\n  });\n}\nconst DeleteFormSchema = z.object({\n  intent: z.literal('delete-note'),\n  noteId: z.string()\n});\nexport async function action({\n  request\n}) {\n  const userId = await requireUserId(request);\n  const formData = await request.formData();\n  await validateCSRF(formData, request.headers);\n  const submission = parse(formData, {\n    schema: DeleteFormSchema\n  });\n  if (submission.intent !== 'submit') {\n    return json({\n      status: 'idle',\n      submission\n    });\n  }\n  if (!submission.value) {\n    return json({\n      status: 'error',\n      submission\n    }, {\n      status: 400\n    });\n  }\n  const {\n    noteId\n  } = submission.value;\n  const note = await prisma.note.findFirst({\n    select: {\n      id: true,\n      ownerId: true,\n      owner: {\n        select: {\n          username: true\n        }\n      }\n    },\n    where: {\n      id: noteId\n    }\n  });\n  invariantResponse(note, 'Not found', {\n    status: 404\n  });\n  const isOwner = note.ownerId === userId;\n  await requireUserWithPermission(request, isOwner ? `delete:note:own` : `delete:note:any`);\n  await prisma.note.delete({\n    where: {\n      id: note.id\n    }\n  });\n  return redirectWithToast(`/users/${note.owner.username}/notes`, {\n    type: 'success',\n    title: 'Success',\n    description: 'Your note has been deleted.'\n  });\n}\nexport default function NoteRoute() {\n  _s();\n  const data = useLoaderData();\n  const user = useOptionalUser();\n  const isOwner = user?.id === data.note.ownerId;\n  const canDelete = userHasPermission(user, isOwner ? `delete:note:own` : `delete:note:any`);\n  const displayBar = canDelete || isOwner;\n  return <div className=\"absolute inset-0 flex flex-col px-10\">\n\t\t\t<h2 className=\"mb-2 pt-12 text-h2 lg:mb-6\">{data.note.title}</h2>\n\t\t\t<div className={`${displayBar ? 'pb-24' : 'pb-12'} overflow-y-auto`}>\n\t\t\t\t<ul className=\"flex flex-wrap gap-5 py-5\">\n\t\t\t\t\t{data.note.images.map(image => <li key={image.id}>\n\t\t\t\t\t\t\t<a href={getNoteImgSrc(image.id)}>\n\t\t\t\t\t\t\t\t<img src={getNoteImgSrc(image.id)} alt={image.altText ?? ''} className=\"h-32 w-32 rounded-lg object-cover\" />\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</li>)}\n\t\t\t\t</ul>\n\t\t\t\t<p className=\"whitespace-break-spaces text-sm md:text-lg\">\n\t\t\t\t\t{data.note.content}\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t{displayBar ? <div className={floatingToolbarClassName}>\n\t\t\t\t\t<span className=\"text-sm text-foreground/90 max-[524px]:hidden\">\n\t\t\t\t\t\t<Icon name=\"clock\" className=\"scale-125\">\n\t\t\t\t\t\t\t{data.timeAgo} ago\n\t\t\t\t\t\t</Icon>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div className=\"grid flex-1 grid-cols-2 justify-end gap-2 min-[525px]:flex md:gap-4\">\n\t\t\t\t\t\t{canDelete ? <DeleteNote id={data.note.id} /> : null}\n\t\t\t\t\t\t<Button asChild className=\"min-[525px]:max-md:aspect-square min-[525px]:max-md:px-0\">\n\t\t\t\t\t\t\t<Link to=\"edit\">\n\t\t\t\t\t\t\t\t<Icon name=\"pencil-1\" className=\"scale-125 max-md:scale-150\">\n\t\t\t\t\t\t\t\t\t<span className=\"max-md:hidden\">Edit</span>\n\t\t\t\t\t\t\t\t</Icon>\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div> : null}\n\t\t</div>;\n}\n_s(NoteRoute, \"DervCVTA0wfLFPjif2ltFzo3whQ=\", false, function () {\n  return [useLoaderData, useOptionalUser];\n});\n_c = NoteRoute;\nexport function DeleteNote({\n  id\n}) {\n  _s2();\n  const actionData = useActionData();\n  const isPending = useIsPending();\n  const [form] = useForm({\n    id: 'delete-note',\n    lastSubmission: actionData?.submission\n  });\n  return <Form method=\"POST\" {...form.props}>\n\t\t\t<AuthenticityTokenInput />\n\t\t\t<input type=\"hidden\" name=\"noteId\" value={id} />\n\t\t\t<StatusButton type=\"submit\" name=\"intent\" value=\"delete-note\" variant=\"destructive\" status={isPending ? 'pending' : actionData?.status ?? 'idle'} disabled={isPending} className=\"w-full max-md:aspect-square max-md:px-0\">\n\t\t\t\t<Icon name=\"trash\" className=\"scale-125 max-md:scale-150\">\n\t\t\t\t\t<span className=\"max-md:hidden\">Delete</span>\n\t\t\t\t</Icon>\n\t\t\t</StatusButton>\n\t\t\t<ErrorList errors={form.errors} id={form.errorId} />\n\t\t</Form>;\n}\n_s2(DeleteNote, \"G+LY8oKPtG3PTaudrP2QM73mqkI=\", false, function () {\n  return [useActionData, useIsPending, useForm];\n});\n_c2 = DeleteNote;\nexport const meta = ({\n  data,\n  params,\n  matches\n}) => {\n  const notesMatch = matches.find(m => m.id === 'routes/users+/$username_+/notes');\n  const displayName = notesMatch?.data?.owner.name ?? params.username;\n  const noteTitle = data?.note.title ?? 'Note';\n  const noteContentsSummary = data && data.note.content.length > 100 ? data?.note.content.slice(0, 97) + '...' : 'No content';\n  return [{\n    title: `${noteTitle} | ${displayName}'s Notes | Epic Notes`\n  }, {\n    name: 'description',\n    content: noteContentsSummary\n  }];\n};\nexport function ErrorBoundary() {\n  return <GeneralErrorBoundary statusHandlers={{\n    403: () => <p>You are not allowed to do that</p>,\n    404: ({\n      params\n    }) => <p>No note with the id \"{params.noteId}\" exists</p>\n  }} />;\n}\n_c3 = ErrorBoundary;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"NoteRoute\");\n$RefreshReg$(_c2, \"DeleteNote\");\n$RefreshReg$(_c3, \"ErrorBoundary\");\n\nwindow.$RefreshReg$ = prevRefreshReg;\nwindow.$RefreshSig$ = prevRefreshSig;"],
  "mappings": "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",
  "names": []
}
