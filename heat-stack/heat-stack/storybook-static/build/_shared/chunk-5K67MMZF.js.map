{
  "version": 3,
  "sources": ["empty-module:#app/utils/honeypot.server.ts", "../../../app/routes/_auth+/onboarding.tsx", "../../../node_modules/remix-utils/build/react/honeypot.js"],
  "sourcesContent": ["module.exports = {};", "// REMIX HMR BEGIN\nif (!window.$RefreshReg$ || !window.$RefreshSig$ || !window.$RefreshRuntime$) {\n  console.warn('remix:hmr: React Fast Refresh only works when the Remix compiler is running in development mode.');\n} else {\n  var prevRefreshReg = window.$RefreshReg$;\n  var prevRefreshSig = window.$RefreshSig$;\n  window.$RefreshReg$ = (type, id) => {\n    window.$RefreshRuntime$.register(type, \"\\\"app/routes/_auth+/onboarding.tsx\\\"\" + id);\n  }\n  window.$RefreshSig$ = window.$RefreshRuntime$.createSignatureFunctionForTransform;\n}\nvar _s = $RefreshSig$();\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\n  import.meta.hot = __hmr__.createHotContext(\n  //@ts-expect-error\n  \"app/routes/_auth+/onboarding.tsx\");\n  import.meta.hot.lastModified = \"1706218436648.8835\";\n}\n// REMIX HMR END\n\nimport { conform, useForm } from '@conform-to/react';\nimport { getFieldsetConstraint, parse } from '@conform-to/zod';\nimport { json, redirect } from '@remix-run/node';\nimport { Form, useActionData, useLoaderData, useSearchParams } from '@remix-run/react';\nimport { AuthenticityTokenInput } from 'remix-utils/csrf/react';\nimport { HoneypotInputs } from 'remix-utils/honeypot/react';\nimport { safeRedirect } from 'remix-utils/safe-redirect';\nimport { z } from 'zod';\nimport { CheckboxField, ErrorList, Field } from '#app/components/forms.tsx';\nimport { Spacer } from '#app/components/spacer.tsx';\nimport { StatusButton } from '#app/components/ui/status-button.tsx';\nimport { requireAnonymous, sessionKey, signup } from '#app/utils/auth.server.ts';\nimport { validateCSRF } from '#app/utils/csrf.server.ts';\nimport { prisma } from '#app/utils/db.server.ts';\nimport { checkHoneypot } from '#app/utils/honeypot.server.ts';\nimport { invariant, useIsPending } from '#app/utils/misc.tsx';\nimport { authSessionStorage } from '#app/utils/session.server.ts';\nimport { redirectWithToast } from '#app/utils/toast.server.ts';\nimport { NameSchema, PasswordAndConfirmPasswordSchema, UsernameSchema } from '#app/utils/user-validation.ts';\nimport { verifySessionStorage } from '#app/utils/verification.server.ts';\nconst onboardingEmailSessionKey = 'onboardingEmail';\nconst SignupFormSchema = z.object({\n  username: UsernameSchema,\n  name: NameSchema,\n  agreeToTermsOfServiceAndPrivacyPolicy: z.boolean({\n    required_error: 'You must agree to the terms of service and privacy policy'\n  }),\n  remember: z.boolean().optional(),\n  redirectTo: z.string().optional()\n}).and(PasswordAndConfirmPasswordSchema);\n_c = SignupFormSchema;\nasync function requireOnboardingEmail(request) {\n  await requireAnonymous(request);\n  const verifySession = await verifySessionStorage.getSession(request.headers.get('cookie'));\n  const email = verifySession.get(onboardingEmailSessionKey);\n  if (typeof email !== 'string' || !email) {\n    throw redirect('/signup');\n  }\n  return email;\n}\nexport async function loader({\n  request\n}) {\n  const email = await requireOnboardingEmail(request);\n  return json({\n    email\n  });\n}\nexport async function action({\n  request\n}) {\n  const email = await requireOnboardingEmail(request);\n  const formData = await request.formData();\n  await validateCSRF(formData, request.headers);\n  checkHoneypot(formData);\n  const submission = await parse(formData, {\n    schema: intent => SignupFormSchema.superRefine(async (data, ctx) => {\n      const existingUser = await prisma.user.findUnique({\n        where: {\n          username: data.username\n        },\n        select: {\n          id: true\n        }\n      });\n      if (existingUser) {\n        ctx.addIssue({\n          path: ['username'],\n          code: z.ZodIssueCode.custom,\n          message: 'A user already exists with this username'\n        });\n        return;\n      }\n    }).transform(async data => {\n      if (intent !== 'submit') return {\n        ...data,\n        session: null\n      };\n      const session = await signup({\n        ...data,\n        email\n      });\n      return {\n        ...data,\n        session\n      };\n    }),\n    async: true\n  });\n  if (submission.intent !== 'submit') {\n    return json({\n      status: 'idle',\n      submission\n    });\n  }\n  if (!submission.value?.session) {\n    return json({\n      status: 'error',\n      submission\n    }, {\n      status: 400\n    });\n  }\n  const {\n    session,\n    remember,\n    redirectTo\n  } = submission.value;\n  const authSession = await authSessionStorage.getSession(request.headers.get('cookie'));\n  authSession.set(sessionKey, session.id);\n  const verifySession = await verifySessionStorage.getSession();\n  const headers = new Headers();\n  headers.append('set-cookie', await authSessionStorage.commitSession(authSession, {\n    expires: remember ? session.expirationDate : undefined\n  }));\n  headers.append('set-cookie', await verifySessionStorage.destroySession(verifySession));\n  return redirectWithToast(safeRedirect(redirectTo), {\n    title: 'Welcome',\n    description: 'Thanks for signing up!'\n  }, {\n    headers\n  });\n}\nexport async function handleVerification({\n  submission\n}) {\n  invariant(submission.value, 'submission.value should be defined by now');\n  const verifySession = await verifySessionStorage.getSession();\n  verifySession.set(onboardingEmailSessionKey, submission.value.target);\n  return redirect('/onboarding', {\n    headers: {\n      'set-cookie': await verifySessionStorage.commitSession(verifySession)\n    }\n  });\n}\nexport const meta = () => {\n  return [{\n    title: 'Setup Epic Notes Account'\n  }];\n};\nexport default function SignupRoute() {\n  _s();\n  const data = useLoaderData();\n  const actionData = useActionData();\n  const isPending = useIsPending();\n  const [searchParams] = useSearchParams();\n  const redirectTo = searchParams.get('redirectTo');\n  const [form, fields] = useForm({\n    id: 'onboarding-form',\n    constraint: getFieldsetConstraint(SignupFormSchema),\n    defaultValue: {\n      redirectTo\n    },\n    lastSubmission: actionData?.submission,\n    onValidate({\n      formData\n    }) {\n      return parse(formData, {\n        schema: SignupFormSchema\n      });\n    },\n    shouldRevalidate: 'onBlur'\n  });\n  return <div className=\"container flex min-h-full flex-col justify-center pb-32 pt-20\">\n\t\t\t<div className=\"mx-auto w-full max-w-lg\">\n\t\t\t\t<div className=\"flex flex-col gap-3 text-center\">\n\t\t\t\t\t<h1 className=\"text-h1\">Welcome aboard {data.email}!</h1>\n\t\t\t\t\t<p className=\"text-body-md text-muted-foreground\">\n\t\t\t\t\t\tPlease enter your details.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<Spacer size=\"xs\" />\n\t\t\t\t<Form method=\"POST\" className=\"mx-auto min-w-full max-w-sm sm:min-w-[368px]\" {...form.props}>\n\t\t\t\t\t<AuthenticityTokenInput />\n\t\t\t\t\t<HoneypotInputs />\n\t\t\t\t\t<Field labelProps={{\n          htmlFor: fields.username.id,\n          children: 'Username'\n        }} inputProps={{\n          ...conform.input(fields.username),\n          autoComplete: 'username',\n          className: 'lowercase'\n        }} errors={fields.username.errors} />\n\t\t\t\t\t<Field labelProps={{\n          htmlFor: fields.name.id,\n          children: 'Name'\n        }} inputProps={{\n          ...conform.input(fields.name),\n          autoComplete: 'name'\n        }} errors={fields.name.errors} />\n\t\t\t\t\t<Field labelProps={{\n          htmlFor: fields.password.id,\n          children: 'Password'\n        }} inputProps={{\n          ...conform.input(fields.password, {\n            type: 'password'\n          }),\n          autoComplete: 'new-password'\n        }} errors={fields.password.errors} />\n\n\t\t\t\t\t<Field labelProps={{\n          htmlFor: fields.confirmPassword.id,\n          children: 'Confirm Password'\n        }} inputProps={{\n          ...conform.input(fields.confirmPassword, {\n            type: 'password'\n          }),\n          autoComplete: 'new-password'\n        }} errors={fields.confirmPassword.errors} />\n\n\t\t\t\t\t<CheckboxField labelProps={{\n          htmlFor: fields.agreeToTermsOfServiceAndPrivacyPolicy.id,\n          children: 'Do you agree to our Terms of Service and Privacy Policy?'\n        }} buttonProps={conform.input(fields.agreeToTermsOfServiceAndPrivacyPolicy, {\n          type: 'checkbox'\n        })} errors={fields.agreeToTermsOfServiceAndPrivacyPolicy.errors} />\n\t\t\t\t\t<CheckboxField labelProps={{\n          htmlFor: fields.remember.id,\n          children: 'Remember me'\n        }} buttonProps={conform.input(fields.remember, {\n          type: 'checkbox'\n        })} errors={fields.remember.errors} />\n\n\t\t\t\t\t<input {...conform.input(fields.redirectTo, {\n          type: 'hidden'\n        })} />\n\t\t\t\t\t<ErrorList errors={form.errors} id={form.errorId} />\n\n\t\t\t\t\t<div className=\"flex items-center justify-between gap-6\">\n\t\t\t\t\t\t<StatusButton className=\"w-full\" status={isPending ? 'pending' : actionData?.status ?? 'idle'} type=\"submit\" disabled={isPending}>\n\t\t\t\t\t\t\tCreate an account\n\t\t\t\t\t\t</StatusButton>\n\t\t\t\t\t</div>\n\t\t\t\t</Form>\n\t\t\t</div>\n\t\t</div>;\n}\n_s(SignupRoute, \"SbEzVWUNyTwM/qcAIjF6pChQLW8=\", false, function () {\n  return [useLoaderData, useActionData, useIsPending, useSearchParams, useForm];\n});\n_c2 = SignupRoute;\nvar _c, _c2;\n$RefreshReg$(_c, \"SignupFormSchema\");\n$RefreshReg$(_c2, \"SignupRoute\");\n\nwindow.$RefreshReg$ = prevRefreshReg;\nwindow.$RefreshSig$ = prevRefreshSig;", "/* eslint-disable jsx-a11y/autocomplete-valid */\nimport * as React from \"react\";\nconst HoneypotContext = React.createContext({});\nexport function HoneypotInputs({ label = \"Please leave this field blank\", }) {\n    let context = React.useContext(HoneypotContext);\n    let { nameFieldName = \"name__confirm\", validFromFieldName = \"from__confirm\", encryptedValidFrom, } = context;\n    return (React.createElement(\"div\", { id: `${nameFieldName}_wrap`, style: { display: \"none\" }, \"aria-hidden\": \"true\" },\n        React.createElement(\"label\", { htmlFor: nameFieldName }, label),\n        React.createElement(\"input\", { id: nameFieldName, name: nameFieldName, type: \"text\", defaultValue: \"\", autoComplete: \"nope\", tabIndex: -1 }),\n        validFromFieldName && encryptedValidFrom ? (React.createElement(React.Fragment, null,\n            React.createElement(\"label\", { htmlFor: validFromFieldName }, label),\n            React.createElement(\"input\", { id: validFromFieldName, name: validFromFieldName, type: \"text\", value: encryptedValidFrom, readOnly: true, autoComplete: \"off\", tabIndex: -1 }))) : null));\n}\nexport function HoneypotProvider({ children, ...context }) {\n    return (React.createElement(HoneypotContext.Provider, { value: context }, children));\n}\n"],
  "mappings": "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",
  "names": []
}
